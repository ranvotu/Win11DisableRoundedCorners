name: Build Win11DisableRoundedCorners

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:   # cho phép chạy thủ công

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: recursive   # vì repo có .gitmodules

    - name: Setup MSVC
      uses: ilammy/msvc-dev-cmd@v1
      with:
        toolset: 14.40          # tương đương VS 2022, có thể bỏ nếu không cần chỉ định

    - name: Restore NuGet packages (nếu có)
      run: nuget restore Win11DisableRoundedCorners.sln
      shell: cmd

    - name: Build Release x64
      run: |
        msbuild Win11DisableRoundedCorners.sln ^
          /p:Configuration=Release ^
          /p:Platform=x64 ^
          /m ^
          /v:minimal ^
          /clp:ErrorsOnly
      shell: cmd

    - name: Upload artifact (executable + dll nếu cần)
      uses: actions/upload-artifact@v4
      with:
        name: Win11DisableRoundedCorners-Release-x64
        path: |
          Win11DisableRoundedCorners/x64/Release/*.exe
          Win11DisableRoundedCorners/x64/Release/*.dll
          Win11DisableRoundedCorners/x64/Release/*.pdb   # optional
        if-no-files-found: warn
